<!DOCTYPE html>
<html>
<head>
    <title>DFA/NFA Conversion</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css">
    <script src="/static/scripts.js"></script>
</head>
<style>
    .spacer {
    height: 100px;
  }
</style>
<body>
    <h1>DFA/NFA Conversion</h1>
    <div style="width:100%;display: flex; justify-content: center; align-items: center;">
        <form id="dfaForm" method="POST">
            <label for="alphabets">Alphabets (space-separated):</label>
            <input type="text" id="alphabets" name="alphabets"><br><br>
            
            <label for="initial_state">Initial State:</label>
            <input type="text" id="initial_state" name="initial_state"><br><br>
    
            <label for="final_state">Final State:</label>
            <input type="text" id="final_state" name="final_state"><br><br>
    
            <div id="transitions">
                <label>Transitions (State Input NextState):</label><br>
                <div class="transition">
                    <input type="text" name="state" placeholder="State">
                    <input type="text" name="input" placeholder="Input">
                    <input type="text" name="next_state" placeholder="Next State">
                </div>
            </div>
            <button type="button" onclick="addTransition()">Add Transition</button><br><br>
            <button type="button" onclick="submitForm()">Submit</button>
        </form>
    </div>

    <div class="spacer"></div>

    <div style="width: 100%;">
        <div style="width: 50%; height: 100px; float: left;display: flex; justify-content: center; align-items: center;"> 
            <pre id="transition_table"></pre> 
        </div>
        <div style="margin-left: 50%; height: 100px; display: flex; justify-content: center; align-items: center;"> 
            <img id="dfa_graph" src="/static/dfa_graph.png" alt="DFA Graph">
        </div>
    </div>

    <!-- <h2>Transition Table</h2>
    <pre id="transition_table"></pre>

    <h2>DFA Graph</h2>
    <img id="dfa_graph" src="/static/dfa_graph.png" alt="DFA Graph"> -->

    <script>
        function addTransition() {
            const div = document.createElement('div');
            div.className = 'transition';
            div.innerHTML = `
                <input type="text" name="state" placeholder="State">
                <input type="text" name="input" placeholder="Input">
                <input type="text" name="next_state" placeholder="Next State">
            `;
            document.getElementById('transitions').appendChild(div);
        }

        async function submitForm() {
            const form = document.getElementById('dfaForm');
            const formData = new FormData(form);
            const data = {
                alphabets: formData.get('alphabets').split(' '),
                initial_state: formData.get('initial_state'),
                final_state: formData.get('final_state'),
                transitions: []
            };

            document.querySelectorAll('.transition').forEach(transition => {
                const state = transition.querySelector('input[name="state"]').value;
                const input = transition.querySelector('input[name="input"]').value;
                const next_state = transition.querySelector('input[name="next_state"]').value;
                data.transitions.push(`${state} ${input} ${next_state}`);
            });

            data.transitions.push('end'); // Indicate the end of transitions

            const response = await fetch('/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });
            
            const result = await response.json();
            if (result.error) {
                alert(result.error);
            } else {
                document.getElementById('transition_table').textContent = result.transition_table;
                document.getElementById('dfa_graph').src = `/static/dfa_graph.png?${new Date().getTime()}`; // Force reload the image
            }
        }
    </script>
</body>
</html>
